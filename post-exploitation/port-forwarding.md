# Port Forwarding

## Examples

### SSH Tunneling

#### Local Port Forwarding

Scenario: When getting a foothold on a target machine, you find a service running on that machine only listening on local host, so you want to forward it to the Attack machine so you can access it.

```bash
# From Kali (Attack Machine)
# Syntax
ssh -L <local port>:<localhost>:<target port> -l <target user> <target IP>
# Example (from the Pandora machine on HTB)
ssh -L 8888:127.0.0.1:80 -l daniel 10.129.250.50
```

### SSH Tunneling 2

#### 3 Types

1. Local port forwarding
2. Remote port forwarding
3. Dynamic port forwarding

#### Local Port Forwarding

If we look at our local Kali host `http://127.0.0.1:8080` nothing is currently running there.

Now use SSH to connect to my target server on port 80, but access it on port 8080 locally.

```bash
# From Kali
ssh -f -nNT -L 8080:localhost:80 target_user@target_IP
ssh -f -nNT -L 8080:localhost:80 msfadmin@10.0.2.8
```

Should now be able to navigate to `http://127.0.0.1:8080` and see the target's web page.

We can use `lsof` to kill it: `lsof -i` and kill the PID of the process.

#### Remote Port Forwarding

```bash
# From Target
sudo ssh -R 2222:localhost:22 kali@kali_IP
# From Kali
ssh target_IP -p 2222
```

#### Running HTTP through an SSH Tunnel

```bash
# From Target
sudo ssh -f -nNT -R 8080:localhost:80 msfadmin@10.0.2.8
# From Kali
# Can now navigate to 10.0.2.8 in a browser. Was not available prior.
```

#### Dynamic Port Forwarding

```bash
# From Kali
ssh -f - N -D 9050 kali@intermediate_IP  # Dual homed with second IP of 10.1.1.7
proxychains ssh 10.1.1.5  # Target IP
```

